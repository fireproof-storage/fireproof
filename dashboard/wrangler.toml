name = "fireproof-dashboard"
main = "backend/cf-serve.ts"
compatibility_date = "2025-02-24"
compatibility_flags = ["nodejs_compat"]

vars = { ENVIRONMENT = "dev" }
routes = [
  { pattern = "dev.connect.fireproof.direct", custom_domain = true }
]

[assets]
directory = "dist/static"
binding = "ASSETS"
html_handling = "force-trailing-slash"
not_found_handling = "single-page-application" 

[[d1_databases]]
binding = "DB"
database_name = "fp-connect-dev"
database_id = "04b54bac-85e4-4a4d-9527-bce490761b12"

[env.dev]

[env.staging]
vars = { ENVIRONMENT = "staging" }
route = "staging.connect.fireproof.direct/*"

[env.production]
vars = { ENVIRONMENT = "production" }
route = "connect.fireproof.direct/*"

# [[env.staging.d1_databases]]
# binding = "DB"
# database_name = "fp-connect-staging"
# database_id = "374bd02f-9a9d-41da-84bc-9b8582706f9a"

#[durable_objects]
#bindings = [
#  # { name = "FP_DO", class_name = "FPDurableObject", script_name = "cf-dobj-abstract-sql" }
#  { name = "FP_BACKEND_DO", class_name = "FPBackendDurableObject" },
#  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
#]
#
#[[migrations]]
#tag = "v1" # Should be unique for each entry
#new_sqlite_classes = ["FPBackendDurableObject"]
#
#[observability]
#enabled = true
#head_sampling_rate = 1
#
#
#[env.test.vars]
#VERSION = "FP-MSG-1.0"
#STORAGE_URL = "http://localhost:9000/testbucket"
#ACCESS_KEY_ID = "minioadmin"
#SECRET_ACCESS_KEY = "minioadmin"
#FP_DEBUG = "FPMetaGroups"
##FP_FORMAT = "yaml"
## TEST_DATE = "20241121T225359Z"
#FP_PROTOCOL = "http"
#CF_BACKEND_MODE = "DURABLE_OBJECT"
#
## [env.test.services]
## bindings = [
##   { binding = "FP_DO", service = "FP_DO" }
## ]
#
#[[env.test.d1_databases]]
#binding = "FP_BACKEND_D1"
#database_name = "test-meta-merge"
#database_id = "b8b452ed-b1d9-478f-b56c-c5e4545f157a"
#
#[[env.test.migrations]]
#tag = "v1" # Should be unique for each entry
#new_sqlite_classes = ["FPBackendDurableObject"]
#
#[env.test.durable_objects]
#bindings = [
#  { name = "FP_BACKEND_DO", class_name = "FPBackendDurableObject" },
#  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
#]
#
#
#[env.test-reqRes-D1.vars]
#VERSION = "FP-MSG-1.0"
#STORAGE_URL = "http://localhost:9000/testbucket"
#ACCESS_KEY_ID = "minioadmin"
#SECRET_ACCESS_KEY = "minioadmin"
#FP_DEBUG = "FPMetaGroups"
##FP_FORMAT = "yaml"
## TEST_DATE = "20241121T225359Z"
#FP_PROTOCOL = "http"
#
#[[env.test-reqRes-D1.d1_databases]]
#binding = "FP_BACKEND_D1"
#database_name = "test-meta-merge"
#database_id = "b8b452ed-b1d9-478f-b56c-c5e4545f157a"
#
#[env.test-reqRes-D1.durable_objects]
#bindings = [
#  { name = "FP_BACKEND_DO", class_name = "FPBackendDurableObject" },
#  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
#]
#
#[env.test-reqRes-DO.vars]
#VERSION = "FP-MSG-1.0"
#STORAGE_URL = "http://localhost:9000/testbucket"
#ACCESS_KEY_ID = "minioadmin"
#SECRET_ACCESS_KEY = "minioadmin"
#FP_DEBUG = "FPMetaGroups"
##FP_FORMAT = "yaml"
## TEST_DATE = "20241121T225359Z"
#FP_PROTOCOL = "http"
#CF_BACKEND_MODE = "DURABLE_OBJECT"
#
#[env.test-reqRes-DO.durable_objects]
#bindings = [
#  { name = "FP_BACKEND_DO", class_name = "FPBackendDurableObject" },
#  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
#]
#
#[env.test-stream-D1.vars]
#VERSION = "FP-MSG-1.0"
#STORAGE_URL = "http://localhost:9000/testbucket"
#ACCESS_KEY_ID = "minioadmin"
#SECRET_ACCESS_KEY = "minioadmin"
#FP_DEBUG = "FPMetaGroups"
##FP_FORMAT = "yaml"
## TEST_DATE = "20241121T225359Z"
#FP_PROTOCOL = "ws"
#
#
#[env.test-stream-D1.durable_objects]
#bindings = [
#  { name = "FP_BACKEND_DO", class_name = "FPBackendDurableObject" },
#  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
#]
#
#[[env.test-stream-D1.d1_databases]]
#binding = "FP_BACKEND_D1"
#database_name = "test-meta-merge"
#database_id = "b8b452ed-b1d9-478f-b56c-c5e4545f157a"
#
#
#[env.test-stream-DO.vars]
#VERSION = "FP-MSG-1.0"
#STORAGE_URL = "http://localhost:9000/testbucket"
#ACCESS_KEY_ID = "minioadmin"
#SECRET_ACCESS_KEY = "minioadmin"
#FP_DEBUG = "FPMetaGroups"
##FP_FORMAT = "yaml"
## TEST_DATE = "20241121T225359Z"
#FP_PROTOCOL = "ws"
#CF_BACKEND_MODE = "DURABLE_OBJECT"
#
#[env.test-stream-DO.durable_objects]
#bindings = [
#  { name = "FP_BACKEND_DO", class_name = "FPBackendDurableObject" },
#  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
#]
#
#
