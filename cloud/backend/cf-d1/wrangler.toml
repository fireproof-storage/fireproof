name = "fireproof-v2-cloud"
main = "server.ts"
compatibility_date = "2025-02-24"
# not really needed, but there are some warning of type imports
compatibility_flags = ["nodejs_compat"]
# upload_source_maps = true

# R2 bucket for blob storage (replaces MinIO/S3 for local dev)
[[r2_buckets]]
binding = "FP_STORAGE"
bucket_name = "fp-storage-local"
preview_bucket_name = "fp-storage-preview"

# D1 database for meta storage
[[d1_databases]]
binding = "FP_BACKEND_D1"
database_name = "fp-meta-local"
database_id = "local-dev-database"

[durable_objects]
bindings = [
  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
]

[[migrations]]
tag = "v1"
new_classes = [ "FPRoomDurableObject" ]

# [[migrations]]
# tag = "v1" # Should be unique for each entry
# new_sqlite_classes = ["FPBackendDurableObject"]

[observability]
enabled = true
head_sampling_rate = 1

[env.test.vars]
VERSION = "FP-MSG-1.0"

[env.test.durable_objects]
bindings = [
  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
]

[[env.test.r2_buckets]]
binding = "FP_STORAGE"
bucket_name = "fp-storage-test"

[[env.test.d1_databases]]
binding = "FP_BACKEND_D1"
database_name = "test-meta-merge"
database_id = "b0c1ea22-b733-420c-b812-bea9ffaa1676"

[env.dev.vars]
VERSION = "FP-MSG-1.0"

[[env.dev.migrations]]
tag = "v1"
new_classes = ["FPRoomDurableObject"]

[env.dev.durable_objects]
bindings = [
  { name = "FP_WS_ROOM", class_name = "FPRoomDurableObject" }
]

[[env.dev.r2_buckets]]
binding = "FP_STORAGE"
bucket_name = "fp-storage-dev"

[[env.dev.d1_databases]]
binding = "FP_BACKEND_D1"
database_name = "fp-cloud-dev"
database_id = "b0c1ea22-b733-420c-b812-bea9ffaa1676"

