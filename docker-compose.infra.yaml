# Fireproof Cloud - Infrastructure Only
#
# NOTE: With wrangler dev, no separate infrastructure is needed.
# R2 storage is provided by wrangler's local emulation.
#
# For local development, just run wrangler dev directly:
#
#   # Terminal 1 - Cloud Backend (with R2 storage)
#   cd cloud/backend/cf-d1
#   npx wrangler dev --local --persist-to .wrangler/state --port 8909
#
#   # Terminal 2 - Dashboard Backend
#   cd dashboard/backend && pnpm run build && pnpm run backend:node
#
#   # Terminal 3 - Dashboard Frontend (dev mode)
#   cd dashboard/frontend && pnpm run dev
#
# If you prefer Docker for infrastructure, this file runs just the
# cloud backend with wrangler dev:

services:
  cloud-backend:
    build:
      context: .
      dockerfile: docker/Dockerfile.cloud-backend
    container_name: fireproof-cloud-backend
    ports:
      - "8909:8909"
    environment:
      NODE_ENV: development
      VERSION: FP-MSG-1.0
      FP_DEBUG: "true"
    volumes:
      - wrangler_state:/app/.wrangler
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8909/health"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  wrangler_state:

networks:
  default:
    name: fireproof-network
